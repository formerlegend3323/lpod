<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>lpod debug</title>

<style>
body {
  background:#111;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
  margin:0;
  font-family: monospace;
}

#ipod {
  width:260px;
  background:#e5e5e5;
  border-radius:30px;
  padding:15px;
}

#screen {
  background:#cfd6cf;
  height:160px;
  border-radius:6px;
  padding:6px;
  box-sizing:border-box;
}

#header {
  text-align:center;
  font-weight:bold;
}

#menu {
  list-style:none;
  padding:0;
  margin:6px 0 0 0;
}

#menu li {
  padding:4px;
}

#menu li.active {
  background:black;
  color:white;
}

#status {
  font-size:10px;
  margin-top:4px;
}

#wheel {
  margin-top:15px;
  width:200px;
  height:200px;
  border-radius:50%;
  background:#ddd;
  position:relative;
  margin-left:auto;
  margin-right:auto;
}

#wheel button {
  position:absolute;
  border:none;
  background:none;
  font-weight:bold;
  cursor:pointer;
}

#btn-menu { top:10px; left:75px; }
#btn-play { bottom:10px; left:80px; }
#btn-prev { left:10px; top:85px; }
#btn-next { right:10px; top:85px; }
#btn-center {
  width:60px;
  height:60px;
  border-radius:50%;
  background:#bbb;
  top:70px;
  left:70px;
}
</style>
</head>

<body>
<div id="ipod">
  <div id="screen">
    <div id="header">lpod DEBUG</div>
    <ul id="menu"></ul>
    <div id="status"></div>
  </div>

  <div id="wheel">
    <button id="btn-menu">MENU</button>
    <button id="btn-play">▶</button>
    <button id="btn-prev">≪</button>
    <button id="btn-next">≫</button>
    <button id="btn-center"></button>
  </div>
</div>

<input type="file" id="fileInput" accept="audio/*" multiple hidden>
<audio id="audio"></audio>

<script>
const menuEl = document.getElementById('menu');
const statusEl = document.getElementById('status');
const audio = document.getElementById('audio');
const fileInput = document.getElementById('fileInput');

const btnNext = document.getElementById('btn-next');
const btnPrev = document.getElementById('btn-prev');
const btnPlay = document.getElementById('btn-play');
const btnMenu = document.getElementById('btn-menu');
const btnCenter = document.getElementById('btn-center');

let state = 'root';
let cursor = 0;
let library = [];
let current = 0;

const menus = {
  root: ['Local Music','Streaming'],
  local: ['Upload','Play First','Shuffle'],
  streaming: ['Top Radio'],
};

function render() {
  menuEl.innerHTML = '';
  menus[state].forEach((item,i)=>{
    const li = document.createElement('li');
    li.textContent = item;
    if(i === cursor) li.className = 'active';
    menuEl.appendChild(li);
  });
  statusEl.textContent =
    `state=${state} cursor=${cursor} tracks=${library.length}`;
}

function select() {
  const choice = menus[state][cursor];
  statusEl.textContent = `SELECT ${choice}`;

  if(state === 'root') {
    state = choice === 'Local Music' ? 'local' : 'streaming';
    cursor = 0;
  } else if(state === 'local') {
    if(choice === 'Upload') fileInput.click();
    if(choice === 'Play First' && library.length) playIndex(0);
    if(choice === 'Shuffle' && library.length)
      playIndex(Math.floor(Math.random()*library.length));
  } else if(state === 'streaming') {
    loadRadio();
  }
  render();
}

function playIndex(i) {
  current = i;
  audio.src = library[i].url;
  audio.play();
  statusEl.textContent = `PLAYING ${library[i].name}`;
}

fileInput.onchange = e => {
  for(const f of e.target.files) {
    library.push({name:f.name, url:URL.createObjectURL(f)});
  }
  render();
};

async function loadRadio() {
  statusEl.textContent = 'LOADING RADIO';
  const res = await fetch(
    'https://de1.api.radio-browser.info/json/stations/topvote/5'
  );
  const stations = await res.json();
  audio.src = stations[0].url_resolved;
  audio.play();
}

btnNext.onclick = () => {
  cursor = (cursor + 1) % menus[state].length;
  render();
};

btnPrev.onclick = () => {
  cursor = (cursor - 1 + menus[state].length) % menus[state].length;
  render();
};

btnPlay.onclick = () => {
  if(audio.src) audio.paused ? audio.play() : audio.pause();
};

btnMenu.onclick = () => {
  state = 'root';
  cursor = 0;
  render();
};

btnCenter.onclick = select;

render();
</script>
</body>
</html>
