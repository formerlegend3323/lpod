<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>lpod</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
html, body { margin:0; height:100%; display:flex; justify-content:center; align-items:center; background:#111; }
#ipod {
  height: 90vh; /* use most of viewport height */
  width: calc(90vh * 260 / 360); /* keep aspect ratio */
  max-width: 95vw; /* never exceed width */
  background:#e5e5e5;
  border-radius:30px;
  box-shadow:0 10px 30px rgba(0,0,0,.6);
  padding:15px;
  box-sizing:border-box;
}
#screen {
  background:#cfd6cf;
  height: calc(180/360 * 100%);
  border-radius:6px;
  padding:6px;
  box-sizing:border-box;
  overflow:hidden;
}
#header{text-align:center; font-weight:bold;}
#menu, #tracklist{list-style:none;padding:0;margin:6px 0 0 0; max-height:60px; overflow:hidden;}
#menu li, #tracklist li{padding:0.8vh; font-size:1.2vh; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;}
.active{background:black;color:white;}
#track-info{margin-top:0.5vh;font-size:1.2vh;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
#progress-container{width:100%;height:0.8vh;background:#aaa;border-radius:0.4vh;margin-top:0.5vh;position:relative;}
#progress{height:100%;background:#333;border-radius:0.4vh;width:0%;}
#time{font-size:1vh;text-align:right;margin-top:0.2vh;}
#status{font-size:1vh;margin-top:0.2vh;}
#wheel{margin-top:1vh;width:calc(200/360 * 100%);height:calc(200/360 * 100%);border-radius:50%;background:#ddd;position:relative;margin-left:auto;margin-right:auto;}
#wheel button{position:absolute;border:none;background:none;font-weight:bold;cursor:pointer;font-size:2vh;}
#btn-menu{top:2%; left:27%;}
#btn-play{bottom:2%; left:30%;}
#btn-prev{left:5%; top:40%;}
#btn-next{right:5%; top:40%;}
#btn-center{width:calc(60/360 * 100%);height:calc(60/360 * 100%);border-radius:50%;background:#666;top:calc(70/360 * 100%); left:calc(70/360 * 100%); position:absolute;}
#btn-center::after{content:'';position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:calc(25/360 * 100%);height:calc(25/360 * 100%);border-radius:50%;background:#333;}
</style>
</head>
<body>

<div id="ipod">
  <div id="screen">
    <div id="header">lpod</div>
    <ul id="menu"></ul>
    <ul id="tracklist"></ul>
    <div id="track-info"></div>
    <div id="progress-container"><div id="progress"></div></div>
    <div id="time"></div>
    <div id="status"></div>
  </div>

  <div id="wheel">
    <button id="btn-menu">MENU</button>
    <button id="btn-play">▶</button>
    <button id="btn-prev">≪</button>
    <button id="btn-next">≫</button>
    <button id="btn-center"></button>
  </div>
</div>

<input type="file" id="fileInput" accept="audio/*" multiple hidden>
<audio id="audio"></audio>

<script>
// --- Everything else remains same ---
const menuEl = document.getElementById('menu');
const tracklistEl = document.getElementById('tracklist');
const trackInfo = document.getElementById('track-info');
const progressEl = document.getElementById('progress');
const timeEl = document.getElementById('time');
const statusEl = document.getElementById('status');
const audio = document.getElementById('audio');
const fileInput = document.getElementById('fileInput');

const btnNext = document.getElementById('btn-next');
const btnPrev = document.getElementById('btn-prev');
const btnPlay = document.getElementById('btn-play');
const btnMenu = document.getElementById('btn-menu');
const btnCenter = document.getElementById('btn-center');

let state='root'; 
let cursor=0;
let library=[];
let current=0;
let shuffle=false;
let inactivityTimer=null;

const rootMenu=['Local Music','Streaming'];
const musicMenu=['Upload','Play First','Shuffle','Now Playing'];

function resetInactivity(){
  clearTimeout(inactivityTimer);
  if(state==='music'){
    inactivityTimer=setTimeout(()=>{
      if(audio.src) state='nowplaying';
      render();
    },30000);
  }
}

function render(){
  resetInactivity();
  menuEl.innerHTML='';
  tracklistEl.innerHTML='';
  trackInfo.textContent='';
  progressEl.style.width='0%';
  timeEl.textContent='';

  if(state==='root'){
    rootMenu.forEach((item,i)=>{
      const li=document.createElement('li');
      li.textContent=item;
      if(i===cursor) li.className='active';
      menuEl.appendChild(li);
    });
    statusEl.textContent='';
  }
  else if(state==='music'){
    musicMenu.forEach((item,i)=>{
      const li=document.createElement('li');
      li.textContent=item;
      if(i===cursor) li.className='active';
      menuEl.appendChild(li);
    });
    if(cursor>=musicMenu.length){
      library.forEach((track,i)=>{
        const li=document.createElement('li');
        li.textContent=track.name;
        if(i+musicMenu.length===cursor) li.className='active';
        tracklistEl.appendChild(li);
      });
    }
    statusEl.textContent=shuffle?'Shuffle: ON':'';
  }
  else if(state==='nowplaying'){
    if(library[current]){
      trackInfo.textContent = library[current].name;
      statusEl.textContent = shuffle?'Shuffle: ON':'';
      tracklistEl.innerHTML='';
    }
  }
}

function playIndex(i){
  current=i;
  audio.src=library[i].url;
  audio.play();
  state='nowplaying';
  render();
}

fileInput.onchange=e=>{
  for(const f of e.target.files){
    library.push({name:f.name,url:URL.createObjectURL(f)});
  }
  cursor=musicMenu.indexOf('Now Playing')+1;
  render();
};

async function loadRadio(){
  statusEl.textContent='Loading Radio...';
  const res=await fetch('https://de1.api.radio-browser.info/json/stations/topvote/5');
  const stations=await res.json();
  audio.src=stations[0].url_resolved;
  audio.play();
  state='nowplaying';
  render();
}

function formatTime(sec){ let m=Math.floor(sec/60), s=Math.floor(sec%60); return `${m}:${s<10?'0'+s:s}`; }
audio.ontimeupdate=()=>{
  if(state==='nowplaying' && audio.duration){
    progressEl.style.width=(audio.currentTime/audio.duration)*100+'%';
    timeEl.textContent=`${formatTime(audio.currentTime)} / ${formatTime(audio.duration)}`;
  }
};
audio.onended=()=>{ 
  if(library.length){
    current=shuffle?Math.floor(Math.random()*library.length):(current+1)%library.length; 
    playIndex(current); 
  }
}

function select(){
  resetInactivity();
  if(state==='root'){
    if(rootMenu[cursor]==='Local Music'){ state='music'; cursor=0; }
    else if(rootMenu[cursor]==='Streaming'){ loadRadio(); }
  }
  else if(state==='music'){
    if(cursor<musicMenu.length){
      const choice=musicMenu[cursor];
      if(choice==='Upload') fileInput.click();
      else if(choice==='Play First' && library.length) playIndex(0);
      else if(choice==='Shuffle' && library.length){ shuffle=!shuffle; if(shuffle) current=Math.floor(Math.random()*library.length); playIndex(current);}
      else if(choice==='Now Playing' && audio.src) state='nowplaying';
    }
    else{
      current=cursor-musicMenu.length;
      playIndex(current);
    }
  }
  render();
}

btnNext.onclick=()=>{ resetInactivity(); if(state==='nowplaying'){ current=(current+1)%library.length; playIndex(current);}
else if(state==='music'){ cursor=(cursor+1)%(musicMenu.length+library.length); render();}
else if(state==='root'){ cursor=(cursor+1)%rootMenu.length; render(); }};
btnPrev.onclick=()=>{ resetInactivity(); if(state==='nowplaying'){ current=(current-1+library.length)%library.length; playIndex(current);}
else if(state==='music'){ cursor=(cursor-1+musicMenu.length+library.length)%(musicMenu.length+library.length); render();}
else if(state==='root'){ cursor=(cursor-1+rootMenu.length)%rootMenu.length; render(); }};
btnPlay.onclick=()=>{ resetInactivity(); if(audio.src) audio.paused?audio.play():audio.pause(); };
btnMenu.onclick=()=>{ resetInactivity(); state='root'; cursor=0; render(); };
btnCenter.onclick=select;

document.addEventListener('keydown',e=>{
  resetInactivity();
  if(e.key==='ArrowRight' && audio.src) audio.currentTime+=10;
  if(e.key==='ArrowLeft' && audio.src) audio.currentTime-=10;
  if(e.key===' ') { e.preventDefault(); btnPlay.click(); }
});

render();
</script>
</body>
</html>
