<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>lpod</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  background:#111;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
  margin:0;
  font-family: monospace;
}

#ipod {
  width:260px;
  background:#e5e5e5;
  border-radius:30px;
  box-shadow:0 10px 30px rgba(0,0,0,.6);
  padding:15px;
  box-sizing:border-box;
}

#screen {
  background:#cfd6cf;
  height:180px;
  border-radius:6px;
  padding:6px;
  box-sizing:border-box;
  overflow:hidden;
}

#header {
  text-align:center;
  font-weight:bold;
}

#menu, #tracklist {
  list-style:none;
  padding:0;
  margin:6px 0 0 0;
  max-height:60px;
  overflow:hidden;
}

#menu li, #tracklist li {
  padding:4px;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}

.active {
  background:black;
  color:white;
}

#track-info {
  margin-top:6px;
  font-size:12px;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}

#progress-container {
  width:100%;
  height:6px;
  background:#aaa;
  border-radius:3px;
  margin-top:4px;
  position:relative;
}

#progress {
  height:100%;
  background:#333;
  border-radius:3px;
  width:0%;
}

#time {
  font-size:10px;
  text-align:right;
  margin-top:2px;
}

#status {
  font-size:10px;
  margin-top:2px;
}

#wheel {
  margin-top:15px;
  width:200px;
  height:200px;
  border-radius:50%;
  background:#ddd;
  position:relative;
  margin-left:auto;
  margin-right:auto;
}

#wheel button {
  position:absolute;
  border:none;
  background:none;
  font-weight:bold;
  cursor:pointer;
}

#btn-menu { top:10px; left:75px; }
#btn-play { bottom:10px; left:80px; }
#btn-prev { left:10px; top:85px; }
#btn-next { right:10px; top:85px; }
#btn-center {
  width:60px;
  height:60px;
  border-radius:50%;
  background:#666;
  top:70px;
  left:70px;
  position:absolute;
}
#btn-center::after {
  content:'';
  position:absolute;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
  width:25px;
  height:25px;
  border-radius:50%;
  background:#333;
}
</style>
</head>

<body>
<div id="ipod">
  <div id="screen">
    <div id="header">lpod</div>
    <ul id="menu"></ul>
    <ul id="tracklist"></ul>
    <div id="track-info"></div>
    <div id="progress-container"><div id="progress"></div></div>
    <div id="time"></div>
    <div id="status"></div>
  </div>

  <div id="wheel">
    <button id="btn-menu">MENU</button>
    <button id="btn-play">▶</button>
    <button id="btn-prev">≪</button>
    <button id="btn-next">≫</button>
    <button id="btn-center"></button>
  </div>
</div>

<input type="file" id="fileInput" accept="audio/*" multiple hidden>
<audio id="audio"></audio>

<script>
const menuEl = document.getElementById('menu');
const tracklistEl = document.getElementById('tracklist');
const trackInfo = document.getElementById('track-info');
const progressEl = document.getElementById('progress');
const timeEl = document.getElementById('time');
const statusEl = document.getElementById('status');
const audio = document.getElementById('audio');
const fileInput = document.getElementById('fileInput');

const btnNext = document.getElementById('btn-next');
const btnPrev = document.getElementById('btn-prev');
const btnPlay = document.getElementById('btn-play');
const btnMenu = document.getElementById('btn-menu');
const btnCenter = document.getElementById('btn-center');

let state = 'root';
let cursor = 0;
let library = [];
let current = 0;
let shuffle = false;

const menus = {
  root: ['Local Music','Streaming'],
  local: ['Upload','Shuffle'],
  streaming: ['Top Radio'],
};

function renderMenu() {
  menuEl.innerHTML = '';
  menus[state].forEach((item,i)=>{
    const li = document.createElement('li');
    li.textContent = item;
    if(i === cursor) li.className = 'active';
    menuEl.appendChild(li);
  });
}

function renderTrackList() {
  tracklistEl.innerHTML = '';
  if(state==='local' && library.length){
    library.forEach((track,i)=>{
      const li = document.createElement('li');
      li.textContent = track.name;
      if(i===cursor) li.className='active';
      tracklistEl.appendChild(li);
    });
  }
}

function render() {
  renderMenu();
  renderTrackList();
  statusEl.textContent = shuffle ? 'Shuffle: ON' : '';
  if(audio.src && library[current]) {
    trackInfo.textContent = library[current].name;
  } else trackInfo.textContent='';
}

function select() {
  if(state==='root'){
    state = menus.root[cursor]==='Local Music'?'local':'streaming';
    cursor=0;
  } else if(state==='local'){
    if(cursor<menus.local.length){ // top menu options
      const choice = menus.local[cursor];
      if(choice==='Upload') fileInput.click();
      if(choice==='Shuffle' && library.length) {
        shuffle=!shuffle;
        if(shuffle) current = Math.floor(Math.random()*library.length);
        playIndex(current);
      }
    } else { // track list
      current = cursor - menus.local.length;
      playIndex(current);
    }
  } else if(state==='streaming'){
    loadRadio();
  }
  render();
}

function playIndex(i){
  current=i;
  audio.src=library[i].url;
  audio.play();
  render();
}

fileInput.onchange = e => {
  for(const f of e.target.files){
    library.push({name:f.name,url:URL.createObjectURL(f)});
  }
  cursor = menus.local.length; // first track
  render();
};

async function loadRadio(){
  statusEl.textContent='Loading Radio...';
  const res = await fetch('https://de1.api.radio-browser.info/json/stations/topvote/5');
  const stations = await res.json();
  audio.src = stations[0].url_resolved;
  audio.play();
}

function formatTime(sec){
  let m=Math.floor(sec/60), s=Math.floor(sec%60);
  return `${m}:${s<10?'0'+s:s}`;
}

audio.ontimeupdate = () => {
  if(audio.duration){
    progressEl.style.width = (audio.currentTime/audio.duration)*100 + '%';
    timeEl.textContent = `${formatTime(audio.currentTime)} / ${formatTime(audio.duration)}`;
  }
};

audio.onended = () => {
  if(shuffle){
    current = Math.floor(Math.random()*library.length);
  } else {
    current = (current+1)%library.length;
  }
  playIndex(current);
};

btnNext.onclick = () => {
  if(state==='local' && cursor>=menus.local.length){
    current=(current+1)%library.length;
    playIndex(current);
    cursor=menus.local.length + current;
  } else if(state==='local' && cursor<menus.local.length){
    cursor = (cursor + 1) % menus.local.length;
  }
  render();
};

btnPrev.onclick = () => {
  if(state==='local' && cursor>=menus.local.length){
    current=(current-1+library.length)%library.length;
    playIndex(current);
    cursor=menus.local.length + current;
  } else if(state==='local' && cursor<menus.local.length){
    cursor = (cursor - 1 + menus.local.length) % menus.local.length;
  }
  render();
};

btnPlay.onclick = () => { if(audio.src) audio.paused?audio.play():audio.pause(); };
btnMenu.onclick = () => { state='root'; cursor=0; render(); };
btnCenter.onclick = select;

document.addEventListener('keydown', e => {
  if(e.key==='ArrowRight' && audio.src) audio.currentTime+=10;
  if(e.key==='ArrowLeft' && audio.src) audio.currentTime-=10;
  if(e.key===' ') { e.preventDefault(); btnPlay.click(); }
});

render();
</script>
</body>
</html>
